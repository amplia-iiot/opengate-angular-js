!function(e,t){"use strict";angular.module("opengate-angular-js",[]),angular.module("opengate-angular-js").run(["$templateCache",function(e){e.put("views/window-time.select.view.html",'<div class=window-time-container><button type=button class="btn btn-xs" ng-class=oneDayClass ng-click=oneDay()>Last day</button> <button type=button class="btn btn-xs" ng-class=oneWeekClass ng-click=oneWeek()>Last 7 days</button> <button type=button class="btn btn-xs" ng-class=oneMonthClass ng-click=oneMonth()>Last 30 days</button> <button type=button class="btn btn-xs" ng-class=customClass ng-click=custom()>Custom</button> <button type=button class="btn btn-xs btn-info" ng-if=customEnabled ng-disabled=!!errorCustomWindow ng-click=applyCustom()>Apply</button> <button type=button class="btn btn-xs btn-info" ng-if=filterApplied ng-click=clear()>Clear</button><div ng-if=customEnabled class=window-time-body><div class=row><div class=col-xs-12><p class=input-group><label class=control-label>From: {{fromDate | date:\'fullDate\'}}</label> <input readonly datepicker-options=fromOptions type=text class=form-control show-button-bar=false uib-datepicker-popup={{format}} ng-model=date.from is-open=fromPopup.opened ng-required=true close-text=Close ng-change=fromChange()> <span class=input-group-btn><a class="btn btn-sm" ng-click=fromOpen()><i class="glyphicon glyphicon-calendar"></i></a></span></p></div><div class=col-xs-12><div uib-timepicker max=fromMax ng-model=date.from show-meridian=false ng-change=fromChange()></div></div></div><div class=row><div class=col-xs-12><p class=input-group><label class=control-label>To: {{toDate | date:\'fullDate\'}}</label> <input readonly datepicker-options=toOptions type=text class=form-control show-button-bar=false uib-datepicker-popup={{format}} ng-model=date.to is-open=toPopup.opened ng-required=true close-text=Close ng-change=toChange()> <span class=input-group-btn><button type=button class="btn btn-sm" ng-click=toOpen()><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><div class=col-xs-12><div uib-timepicker max=toMax min=toMin ng-model=date.to show-meridian=false ng-change=toChange()></div></div></div><alert type=danger ng-show=errorCustomWindow class=text-danger style="display: block;text-align: center;"><span ng-bind=errorCustomWindow></span></alert></div></div>')}]),angular.module("opengate-angular-js").service("$ogapi",function(){function n(){var n=t;this.api=function(){if("undefined"!=typeof n)return n;throw new Error("Must invoke create([options]) function before api() function")},this.create=function(t){return n=new e.OpenGateAPI(t)},this.release=function(){return n=t,this}}return new n}),angular.module("opengate-angular-js").factory("Filter",["$window","$sce","$q",function(e,n,o){function a(e,t){var o,a,r,i=[];if(e&&0!==e.trim().length){var l=e.toLowerCase().trim();for(o=0;o<t.length&&i.length<8;o++)a=t[o],a.toLowerCase().indexOf(l)>-1&&i.push({label:n.trustAsHtml(s(a,e)),value:a});for(o=0;o<p.length&&i.length<12;o++)r=p[o],r.toLowerCase().indexOf(l)>-1&&i.push({label:n.trustAsHtml(s(r,e)),value:r})}else{for(o=0;o<t.length&&i.length<8;o++)a=t[o],i.push({label:n.trustAsHtml(s(a,e)),value:a});for(o=0;o<p.length&&i.length<12;o++)r=p[o],i.push({label:n.trustAsHtml(s(r,e)),value:r})}return i}function r(e,n,r){var s=o.defer();return r.findFields(e).then(function(o){var r=o,i=-1;if(n.selectionStart?i=n.selectionStart-1:n.prop&&(i=n.prop("selectionStart")-1),!(i<0)){var l;if(e!==t&&""!==e){for(var c=-1;i>=0&&c===-1;i--)d.indexOf(e[i])>-1?c=i+1:0===i&&(c=i);var u=c;for(i=c;i<e.length&&u===c;i++)d.indexOf(e[i])>-1?u=i+1:i===e.length-1&&(u=i+1);l=a(e.substring(c,u),r)}else l=a();l.forEach(function(e){e.value=e.value}),s.resolve(l)}})["catch"](function(e){console.error(e),s.reject(e)}),s.promise}function s(e,t){var n=new RegExp("("+t+")","gi");return e.replace(n,'<span class="text-info">$1</span>')}function i(t){var n=o.defer(),a=n.promise,r=null,s={text:[],offsets:[],filter:{}};try{e.jsep.addBinaryOp("and",1),e.jsep.addBinaryOp("&&",1),e.jsep.addBinaryOp("||",2),e.jsep.addBinaryOp("or",2),e.jsep.addBinaryOp("in",3),e.jsep.addBinaryOp("~",6),e.jsep.addBinaryOp("=",6),e.jsep.addBinaryOp("like",6),e.jsep.addBinaryOp("gt",6),e.jsep.addBinaryOp("lte",6),e.jsep.addBinaryOp("gte",6),e.jsep.addBinaryOp("eq",6),r=e.jsep(t),s.filter[r.operator]=[],s.filter=l(r),n.resolve(s)}catch(i){var c=i;i.description&&(c=i.description),n.reject(c)}return a}function l(e){var t,n,o={};if("BinaryExpression"===e.type&&/\eq|\neq|\like|\gt|\lt|\gte|\lte|\=|\'<'|\'>'|\~|\!/.test(e.operator)){t=c(e.left).split(".").reverse().join("."),n=e.right.name||e.right.value;var a=u(e.operator);o[a]={},o[a][t]=n}else"BinaryExpression"===e.type&&/\or|\and/.test(e.operator)&&(o[e.operator]=[],o[e.operator].push(l(e.left)),o[e.operator].push(l(e.right)));return o}function c(e){var t="";return"Identifier"===e.type?t=e.name:"MemberExpression"===e.type&&(t=e.property.name+"."+c(e.object)),t}function u(e){return"=="===e?"eq":"="===e?"eq":"!="===e?"neq":"~"===e?"like":">"===e?"gt":"<"===e?"lt":">="===e?"gte":"<="===e?"lte":e}var p=[],d=[" ","\n","-","!","=","~",">","<","&","or","and",") "];return{suggest_field_delimited:function(e,t,n){var o=r(e,t,n);return o},parseQuery:function(e){var t=i(e);return t}}}]),angular.module("opengate-angular-js").filter("humanize",["$window",function(e){function t(e){return/\d/.test(e)}return function(n,o,a){var r=n;return e.S(r).indexOf("$")!==-1&&(r=e.S(r).strip("$").s),angular.isString(r)&&!t(r)&&(r=e.S(r).humanize().s),r}}]).filter("communicationsInterface",function(){return function(e){var t=e;switch(t){case"COMMUNICATIONS_MODULE":return"Communications module";case"SUBSCRIPTION":return"Mobile line";case"SUBSCRIBER":return"SIM";case"HOME_OPERATOR":return"Home Operator";case"REGISTER_OPERATOR":return"Register Operator";case"ADDRESS":return"IP";case"SOFTWARE":return"Software";case"HARDWARE":return"Hardware";case"entityKey":return"Identifier";default:return t}}}).filter("dateNames",function(){var e={MON:"Monday",TUE:"Tuesday",WED:"Wednesday",THU:"Thursday",FRI:"Friday",SAT:"Saturday",SUN:"Sunday"},t={JAN:"January",FEB:"February",MAR:"March",APR:"April",MAY:"May",JUN:"June",JUL:"July",AUG:"August",SEP:"September",OCT:"October",NOV:"November",DEC:"December"};return function(n){return e[n]||t[n]||n}}).filter("icons",function(){return function(e,t,n){var o="fa fa-info";return"list"===e&&(o="fa fa-list"),"ban"===e&&(o="fa fa-ban"),"laptop"===e&&(o="fa fa-laptop"),"spin"===e&&(o="fa fa-spinner fa-spin"),"unit"===e&&(o="fa fa-plus-square"),"tags"===e&&(o="fa fa-tags"),o}}).filter("codeErrors",function(){var e={1004:"At least one valid reference to an entity is required",1005:"At least one valid reference to an entity is required",1017:"Tag is not valid. Please, check it."};return function(t){return{code:t.code,message:e[t.code]||t.message}}}).filter("textlength",function(){return function(e){return e&&e.length>30?e.substring(0,30)+"...":e}}),angular.module("opengate-angular-js").directive("windowTimeSelect",function(){return{restrict:"AE",templateUrl:"views/window-time.select.view.html",scope:{event:"@",rawdate:"@"},controller:["$scope","$element","$attrs",function(n,o,a){function r(){return e.moment(n.date.from).add(1,"hours")._d}function s(){return e.moment(n.date.to).subtract(1,"minutes")._d}function i(){return e.moment(n.date.to).subtract(1,"months")._d}function l(e){n.date||(n.date={}),n.date.to=e,n.toMax=e,n.toOptions={startingDay:1,showWeeks:!1,maxDate:e}}function c(){n.date.from=i(n.date.to),n.fromOptions={startingDay:1,showWeeks:!1,maxDate:s(n.date.to)},n.toOptions.minDate=r(),n.toMin=r(),n.fromMax=s(n.date.to)}function u(t){var n=e.moment().subtract(1,t);return{from:n._d,type:t}}n.oneDayClass=n.oneWeekClass=n.oneMonthClass=n.customClass="btn-info",n.filterApplied=!1,n.format="dd MMMM yyyy",n.clear=function(){n.oneDayClass=n.oneWeekClass=n.oneMonthClass=n.customClass="btn-info",n.filterApplied=!1,n.customEnabled=!1,n.$emit("onWindowTimeChanged",{})},n.fromOpen=function(){n.fromPopup.opened=!0},n.fromPopup={opened:!1},n.toOpen=function(){n.toPopup.opened=!0},n.toPopup={opened:!1},n.custom=function(){n.customEnabled=!n.customEnabled},n.apply=function(t,o){if(n.filterApplied=!0,n.customEnabled=!1,!e.eval(n.rawdate)){for(var a in t)"type"!==a&&"rawdate"!==a&&(t[a]=e.moment(t[a]).format());t.rawdate=!1}o&&n.$emit("onWindowTimeChanged",t)},n.oneDay=function(e){n.oneDayClass="btn-success",n.oneWeekClass=n.oneMonthClass=n.customClass="btn-info",n.apply(u("days"),!e)},n.oneWeek=function(e){n.oneWeekClass="btn-success",n.oneDayClass=n.oneMonthClass=n.customClass="btn-info",n.apply(u("weeks"),!e)},n.oneMonth=function(e){n.oneMonthClass="btn-success",n.oneWeekClass=n.oneDayClass=n.customClass="btn-info",n.apply(u("months"),!e)},n.applyCustom=function(e){n.customClass="btn-success",n.oneWeekClass=n.oneDayClass=n.oneMonthClass="btn-info",n.apply({type:"custom",to:n.date.to,from:n.date.from},!e)},n.init=function(){function o(){e.moment(n.date.to).diff(n.date.from)<=0?n.errorCustomWindow="From date("+n.date.from.toISOString()+") is bigger than to date("+n.date.to.toISOString()+")":n.errorCustomWindow=t}if(l(new Date),c(),n.toChange=function(){o(),n.fromOptions={maxDate:s(n.date.to)},n.fromMax=s(n.date.to)},n.fromChange=function(){o(),n.toOptions.minDate=r(),n.toMin=r()},n.$parent.config&&n.$parent.config.windowFilter){var a=n.$parent.config.windowFilter;switch(e.eval(n.rawdate)||(n.$parent.config.windowFilter.rawdate=!1),a.type){case"days":n.oneDay(!0);break;case"weeks":n.oneWeek(!0);break;case"months":n.oneMonth(!0);break;case"custom":a.to&&a.from&&(n.date.to=new Date(a.to),n.date.from=new Date(a.from)),n.applyCustom(!0)}}},n.init()}]}}),angular.module("opengate-angular-js").directive("showErrors",["$timeout","$interpolate",function(e,t){var n=function(n,o,a,r){var s,i,l,c,u,p,d=!1,f=!1;if(c=n.$eval(a.showErrors)||{},u=c.showSuccess||!1,s=o[0].querySelector(".form-control[name]")||o[0].querySelector("[name]"),l=angular.element(s),i=t(l.attr("name")||"")(n),!i)throw"show-errors element has no child input elements with a 'name' attribute class";var m=function(){return e(function(){o.removeClass("has-error"),o.removeClass("has-success"),f=!1},0,!1)};n.$watch(function(){return r[i]&&r[i].$invalid},function(e){return p(e)}),n.$on("show-errors-check-validity",function(e,t){if(angular.isUndefined(t)||r.$name===t)return d=!0,f=!0,p(r[i].$invalid)}),n.$on("show-errors-reset",function(e,t){if(angular.isUndefined(t)||r.$name===t)return m()}),p=function(e){if(o.toggleClass("has-error",f&&e),u)return o.toggleClass("has-success",f&&!e)}};return{restrict:"A",require:"^form",compile:function(e,t){if(t.showErrors.indexOf("skipFormGroupCheck")===-1&&!e.hasClass("form-group")&&!e.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return n}}}]),angular.module("opengate-angular-js").directive("elemReady",["$parse",function(e){return{restrict:"A",link:function(t,n,o){n.ready(function(){t.$apply(function(){var n=e(o.elemReady);n(t)})})}}}]),angular.module("opengate-angular-js").directive("disallowSpaces",function(){return{restrict:"A",link:function(t,n){n.bind("input",function(){e.$(this).val(e.$(this).val().replace(/ /g,""))})}}}),angular.module("opengate-angular-js").directive("customUiSelect",["$compile","Filter",function(e,t){var n=angular.element('<div ng-click="complex()" style="cursor:pointer" class="custom-ui-select-button input-group-addon"><i class="fa fa-filter text-muted"></i></div>'),o=angular.element('<div class="custom-ui-select-container input-group"></div>'),a=function(e,t){var n=e.querySelectorAll("ui-select-choices");n.attr("refresh",t),n.attr("refresh-delay","0")};return{require:"uiSelect",scope:!0,bindToController:!0,controller:["$scope","$element","$attrs",function(e,n,o){function a(e){if(i.prefilter){var t={and:[]};return t.and.push(i.prefilter),t.and.push(e),t}return e}function r(){var t=o.customUiSelectConfig.split(".");if(1===t.length)return e[o.customUiSelectConfig];var n=e;return t.forEach(function(e){n=n[e]}),n}function s(t,n,o,a){t.limit(1e3).filter(a).build().execute().then(function(t){if(200===t.statusCode){var a=[];angular.isFunction(i.processingData)?i.processingData(t,a):a=t.data[o];var r=[];angular.isArray(a)?angular.copy(a,r):angular.forEach(a,function(e,t){r.push(e)}),angular.copy(r,n)}else n.splice(0,n.length),204!==t.statusCode?console.error(JSON.stringify(t)):console.log(JSON.stringify(t));e.$apply()})}var i=r();e.complexfilter=function(e){t.parseQuery(e||"").then(function(e){var t=e.filter;Object.keys(t).length>0?(s(i.builder,i.collection,i.rootKey,a(t)),console.log("Final filter: "+t)):i.collection.splice(0,i.collection.length)})["catch"](function(e){i.collection.splice(0,i.collection.length)})},e.asyncfilter=function(e){s(i.builder,i.collection,i.rootKey,a(i.filter(e)))},e._complex=o.$$button.querySelectorAll(".fa-filter").hasClass("text-primary"),e.complex=function(){e._complex=!e._complex,e._complex?(n.css("display","").removeClass("custom-ui-select-hide"),o.$$cloneElement.css("display","none").addClass("custom-ui-select-hide"),o.$$button.querySelectorAll(".fa-filter").removeClass("text-muted").addClass("text-primary")):(n.css("display","none").addClass("custom-ui-select-hide"),o.$$cloneElement.css("display","").removeClass("custom-ui-select-hide"),o.$$button.querySelectorAll(".fa-filter").addClass("text-muted").removeClass("text-primary"))},e.customUiTagTransform=function(e){return null}}],compile:function(r,s){s.$$button=n.clone(),s.$$container=o.clone();var i="true"!==s.multiple,l=s.tagging;console.log("isSimple: "+i),i&&(r.attr("limit","1"),s.limit="1",s.searchEnabled="!$select.selected || $select.selected.length === 0",r.attr("search-enabled","!$select.selected || $select.selected.length === 0")),l&&0!==l.trim().length||(r.attr("tagging","customUiTagTransform"),s.tagging="customUiTagTransform");var c="asyncfilter($select.search);",u="complexfilter($select.search);";if(s.customMassAutocompleteItem){a(r,u);var p=angular.element(r.clone());p.removeAttr("custom-ui-select"),a(p,c),s.$$templateElement=p}else a(r,c);return function(n,o,a,r){function s(){var e=a.customMassAutocompleteItem.split(".");if(1===e.length)return n[a.customMassAutocompleteItem];var t=n;return e.forEach(function(e){t=t[e]}),t}var i="mass-autocomplete-ui-select",l="async-ui-select";if(a.customMassAutocompleteItem){o.addClass(i);var c=s();c.suggest||(c.suggest=t.suggest_field_delimited);var u=o.querySelectorAll("input.ui-select-search");u.attr("mass-autocomplete-item",a.customMassAutocompleteItem),e(u)(n),a.$$container.empty(),o.before(a.$$container),o.detach(),a.$$container.append(o);var p=a.$$templateElement.clone(),d=e(p)(n,function(e,t){a.$$container.append(e)});d.addClass(l),a.$$cloneElement=d,e(a.$$button)(n),a.$$container.append(a.$$button),o.css("display","none").addClass("custom-ui-select-hide");var f=[];a.$$container.bind("keydown",function(e){f.push(e.keyCode)}),a.$$container.bind("keyup",function(e){f.length>0&&(angular.equals(f,[17,18,70])&&n.complex(),f.splice(0,f.length))})}else o.addClass(l)}}}}])}(window);